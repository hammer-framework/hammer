# Redwood Studio [Experimental]

## About
This package intends to contain the redwood development studio. The studio contains a dashboard users can use during development to gain insights into their project.

## Running Studio

To run the redwood studio simply execute the following redwood cli command:
```bash
yarn rw experimental studio
```

## Studio Config

You may provide the following configuration options in your `redwood.toml` file to control the behaviour of the studio.

```toml
[experimental.studio]
  # Determines whether the studio should run with an in memory database or persist the data to a file in your project within `./redwood`
  inMemory = false

[experimental.studio.graphiql]
  endpoint = 'graphql'

[experimental.studio.graphiql.authImpersonation]
  # authProvider = undefined (default value)
  jwtSecret = 'secret'
  # userId = undefined (default value)
  # email = undefined (default value)
  # roles = undefined (default value)
```

## OpenTelemetry Ingestion

The redwood studio can ingest your OpenTelemetry data and indeed requires this data to power the insights that it is able to provide.

To enable ingestion of OpenTelemetry tracing into the studio please provide the following export location for your tracing data within `opentelemetry.js` to be `http://127.0.0.1:4318/v1/traces` which is the default generated by the OpenTelemetry setup command.
```ts
const exporter = new OTLPTraceExporter({
  // Update this URL to point to where your OTLP compatible collector is listening
  // The redwood development dashboard (`yarn rw dashboard`) can collect your telemetry at `http://127.0.0.1:4318/v1/traces`
  url: 'http://127.0.0.1:4318/v1/traces',
})
```

## GraphiQL Auth Impersonation

### DbAuth

Requires `SESSION_SECRET` envar for cookie encryption.

TOML example:

```toml
[web]
  port = 8888
[experimental.studio]
  inMemory = false
[experimental.studio.graphiql]
  endpoint = "graphql"
[experimental.studio.graphiql.authImpersonation]
  authProvider = "dbAuth"
  email = "user@example.com"
  userId = "1"
```

### Netlify

Since Netlify does not expose the JWT secret used to sign the token in production, impersonation requires a `jwtSecret` to encode and decode the auth token.

TOML example:

```toml
[web]
  port = 8888
[experimental.studio]
  inMemory = false
[experimental.studio.graphiql]
  endpoint = "graphql"
[experimental.studio.graphiql.authImpersonation]
  authProvider = "netlify"
  email = "user@example.com"
  userId = "1"
  jwtSecret = "some-secret-setting"
```

### Supabase

Requires `SUPABASE_JWT_SECRET` envar for JWT signing.

TOML example:

```toml
[web]
  port = 8888
[experimental.studio]
  inMemory = false
[experimental.studio.graphiql]
  endpoint = "graphql"
[experimental.studio.graphiql.authImpersonation]
  authProvider = "supabase"
  email = "user@example.com"
  userId = "1"
```
